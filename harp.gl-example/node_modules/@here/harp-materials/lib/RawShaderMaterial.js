"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.RawShaderMaterial = void 0;
/*
 * Copyright (C) 2020 HERE Europe B.V.
 * Licensed under Apache 2.0, see full license in LICENSE
 * SPDX-License-Identifier: Apache-2.0
 */
const harp_utils_1 = require("@here/harp-utils");
const THREE = require("three");
/**
 * Base class for all raw shader materials. Ensures WebGL2 compatibility for WebGL1 shaders.
 */
class RawShaderMaterial extends THREE.RawShaderMaterial {
    /**
     * The constructor of `RawShaderMaterial`.
     *
     * @param params - `RawShaderMaterial` parameters.  Always required except when cloning
     * another material.
     */
    constructor(params) {
        const isWebGL2 = (params === null || params === void 0 ? void 0 : params.rendererCapabilities.isWebGL2) === true;
        const shaderParams = params
            ? Object.assign(Object.assign({}, params), { glslVersion: isWebGL2 ? THREE.GLSL3 : THREE.GLSL1, vertexShader: isWebGL2 && params.vertexShader
                    ? harp_utils_1.convertVertexShaderToWebGL2(params.vertexShader)
                    : params.vertexShader, fragmentShader: isWebGL2 && params.fragmentShader
                    ? harp_utils_1.convertFragmentShaderToWebGL2(params.fragmentShader)
                    : params.fragmentShader }) : undefined;
        // Remove properties that are not in THREE.ShaderMaterialParameters, otherwise THREE.js
        // will log warnings.
        if (shaderParams) {
            delete shaderParams.rendererCapabilities;
        }
        super(shaderParams);
    }
}
exports.RawShaderMaterial = RawShaderMaterial;
//# sourceMappingURL=RawShaderMaterial.js.map